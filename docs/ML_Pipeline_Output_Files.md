# ML Pipeline Output Files Reference

## Standardized Naming Convention

The system uses a **standardized naming format** for all generated files:

**Format**: `{source}_{period}_{stage}_{timestamp}.csv`

Where:
- **source**: `unionbank_visa`, `household_cash`, `bpi_mastercard` (standardized, no spaces)
- **period**: `YYYY-MM` (statement period, not processing date)
- **stage**: `predictions`, `corrected`, `accounting`, `training`
- **timestamp**: `YYYYMMDD_HHMMSS` (when processed, for uniqueness)

**Benefits:**
- Clear purpose from filename
- Source and period preserved
- Chronological sorting works naturally
- No spaces or special characters

## Input Files

### Excel Files (Current Standard)
| File Type | Example | Script Support |
|---|---|---|
| Credit Card (UnionBank) | `Statement UNIONBANK Visa 8214 2025-09.xlsx` | `src/batch_predict_ensemble.py`, Web Interface |
| Credit Card (BPI) | `Statement BPI Mastercard 2025-09.xlsx` | `src/batch_predict_ensemble.py`, Web Interface |
| Household | Excel exports from accounting systems | `src/transform_monthly_household_transactions.py` |

**Features:**
- Automatic format detection via `src/utils/file_detector.py`
- Currency symbol removal (PHP, $, etc.) via `src/utils/excel_processor.py`
- Direct processing without manual conversion

### CSV Files (Legacy - Still Supported)
| File Type | Example |
|---|---|
| Household | `House Kitty Transactions - Cash 2025-08.csv` |
| Credit Card | `For Automl Statement UNIONBANK Visa 2025-07.csv` |

## Prediction Files

### New Standardized Format
| Filename Pattern | Script | Description | Location |
|---|---|---|---|
| `{source}_{period}_predictions_{timestamp}.csv` | `src/batch_predict_ensemble.py` | Transactions with predicted categories and confidence scores | `data/results/` |

**Examples**:
- `unionbank_visa_2025-09_predictions_20251025_151435.csv`
- `household_cash_2025-08_predictions_20250809_101640.csv`

### Legacy Format (Transitional Support)
| Filename Pattern | Description |
|---|---|
| `processed_{input_basename}_v{version}_{timestamp}.csv` | Old format still generated by some older scripts |

**Example**: `processed_For Automl Statement UNIONBANK Visa 2025-05_v1.0_20250608_190731.csv`

**Note**: The system handles both formats seamlessly with fallback support in `src/utils/filename_utils.py`

## Training Data Files
| Filename Pattern | Script | Description | Location |
|---|---|---|---|
| `training_data_{source}_v{version}_{date}.csv` | `src/merge_training_data.py` | Source-specific training data with merged corrections | `data/` |

**Examples**: 
- `training_data_household_v6_20250503.csv`
- `training_data_credit_card_v4_20250609.csv`

## Model Files
| Filename Pattern | Script | Description | Location |
|---|---|---|---|
| `{source}_{algorithm}_model_v{version}.pkl` | `src/auto_model_ensemble.py` | Trained ML model for specific source and algorithm | `models/` |
| `{source}_tfidf_vectorizer_model_v{version}.pkl` | `src/auto_model_ensemble.py` | TF-IDF vectorizer for specific transaction source | `models/` |
| `{source}_label_encoder_model_v{version}.pkl` | `src/auto_model_ensemble.py` | Label encoder for mapping categories to numbers | `models/` |

**Examples**:
- `household_lgbm_model_v2.pkl`
- `credit_card_xgboost_model_v4.pkl`
- `household_tfidf_vectorizer_model_v2.pkl`

## Log Files
| Filename Pattern | Script | Description | Location |
|---|---|---|---|
| `batch_predict_{datetime}.log` | `src/batch_predict_ensemble.py` | Logs from batch prediction process | `logs/` |
| `correction_validation_{datetime}.log` | `src/merge_training_data.py` | Logs from correction validation process | `logs/` |
| `training.log` | `src/auto_model_ensemble.py` | Logs from model training process | `logs/` |
| `classification_report_{model_name}.txt` | `src/auto_model_ensemble.py` | Classification performance metrics for each model | `logs/` |
| `shap_summary_{model_name}.png` | `src/auto_model_ensemble.py` | SHAP explanations visualization (if enabled) | `logs/` |
| `prediction_metrics.jsonl` | `src/batch_predict_ensemble.py` | JSON lines with prediction quality metrics | `logs/` |

## Registry & Configuration Files
| Filename Pattern | Script | Description | Location |
|---|---|---|---|
| `model_registry.json` | `src/model_registry.py` | Registry of all model versions and metadata | `models/registry/` |
| `valid_categories.txt` | Manual | List of approved expense categories | `data/` |

## Transformed Data Files
| Filename Pattern | Script | Description | Location |
|---|---|---|---|
| `House Kitty Transactions - Cash - Corrected {YYYY-MM}.csv` | `src/transform_monthly_household_transactions.py` | Household data converted to ML format | Google Drive folder |

## File Naming Key

### Standardized Output Files
- `{source}`: Standardized source identifier
  - `unionbank_visa` - UnionBank credit card transactions
  - `household_cash` - Household cash expense tracking
  - `bpi_mastercard` - BPI credit card transactions
  - Format: `lowercase_with_underscores`
- `{period}`: Statement period in `YYYY-MM` format (e.g., `2025-09`)
- `{stage}`: Processing stage
  - `input` - Raw uploaded files
  - `predictions` - ML model predictions
  - `corrected` - User-corrected predictions
  - `accounting` - Accounting system format
  - `training` - Training data for ML models
- `{timestamp}`: Processing timestamp in `YYYYMMDD_HHMMSS` format

### Training Data & Models
- `{source}` (for training/models): `household` or `credit_card`
- `{algorithm}`: `lgbm`, `xgboost`, or `catboost`
- `{version}`: Incremental version number (1, 2, 3, ...)
- `{date}`: Format `YYYYMMDD`

## File Lifecycle

### Credit Card Workflow
```
Excel/CSV Upload → Automatic Format Detection → Predict →
Manual Corrections → Merge → Train → New Models → Registry Update
```

### Household Workflow
```
Excel/CSV Download → Transform → Predict → Manual Corrections →
Merge → Train → New Models → Registry Update
```

**Key Processing Steps:**
1. **Upload/Input**: Excel (.xlsx, .xls) or CSV files
2. **Detection**: Automatic format and transaction type detection
3. **Cleaning**: Currency symbols removed, amounts standardized
4. **Prediction**: Ensemble ML models generate categories with confidence scores
5. **Correction**: Manual review and corrections by user
6. **Merge**: Corrections integrated into training data
7. **Training**: Models retrained with accumulated feedback

## Cleanup Guidelines
### Safe to Delete
- Prediction files older than 30 days
- Log files older than 90 days
- Old model versions (keep latest 2-3 versions)

### Keep Permanently  
- `model_registry.json`
- `valid_categories.txt`
- Latest training data files
- Latest model files

### Archive Periodically
- Old training data versions
- Historical prediction files
- Old model versions (for rollback capability)